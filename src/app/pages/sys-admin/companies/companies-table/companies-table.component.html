<mat-accordion>
  <mat-expansion-panel expanded="{{panelOpenState}}" (opened)="panelOpenState = true" (closed)="panelOpenState = false">
    <mat-expansion-panel-header>

      <mat-panel-title>
        <div class="text-center col-12 h5">
          {{'COMPANIES_TABLE.COMPANYINFO' | translate}}
        </div>

      </mat-panel-title>
    </mat-expansion-panel-header>
    <div class="col-12">

      <mat-form-field class="col-3 float-start">
        <mat-label>{{"COMPANIES_TABLE.FILTER" | translate}}</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="{{'COMPANIES_TABLE.SEARCH_COMPANY' | translate}}"
          #input>
      </mat-form-field>

      <button class="col-3 float-end" routerLink="./AddCompany" [queryParams]="{ mode: 'add' }"
        ngbTooltip="{{'COMPANIES_TABLE.ADD_COMPANY' | translate}}" mat-icon-button
        aria-label="Example icon button with a open in new tab icon">
        <mat-icon>add_circle</mat-icon></button>

      <mat-paginator [pageSizeOptions]="[25, 50, 100, 150]"
        [attr.aria-label]="'COMPANIES_TABLE.PAGINATOR' | translate"></mat-paginator>
    </div>

    <div class="mat-elevation-z8 col-12 center">
      <table class="table table-sm table-striped table-hover" mat-table [dataSource]="dataSource" matSort>

        <!-- id -->
        <ng-container matColumnDef="idCompany">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"COMPANIES_TABLE.ID_COMPANY" | translate}} </th>
          <td [ngClass]="{
            
            'table-danger': !row.contractSigned
          }" mat-cell *matCellDef="let row"> <span [ngbTooltip]="!row.contractSigned 
              ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate) 
              : (row.confirmationToken 
                  ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate) 
                  : '')">{{row.idCompany}}
            </span></td>
        </ng-container>
        <!-- Nombre legal -->
        <ng-container matColumnDef="legalName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"COMPANIES_TABLE.LEGAL_NAME" | translate}} </th>
          <td [ngClass]="{
            
            'table-danger': !row.contractSigned
          }" mat-cell *matCellDef="let row"> <span [ngbTooltip]="!row.contractSigned 
              ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate) 
              : (row.confirmationToken 
                  ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate) 
                  : '')">{{row.legalName}}
            </span></td>
        </ng-container>

        <ng-container matColumnDef="commercialName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"COMPANIES_TABLE.COMMERCIAL_NAME" | translate}} </th>
          <td [ngClass]="{
            
            'table-danger': !row.contractSigned
          }" mat-cell *matCellDef="let row"> <span [ngbTooltip]="!row.contractSigned 
              ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate) 
              : (row.confirmationToken 
                  ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate) 
                  : '')">{{row.commercialName}}
            </span></td>
        </ng-container>

        <!-- RFC -->
        <ng-container matColumnDef="rfc">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"COMPANIES_TABLE.RFC" | translate}} </th>
          <td [ngClass]="{
            
            'table-danger': !row.contractSigned
          }" mat-cell *matCellDef="let row"> <span [ngbTooltip]="!row.contractSigned 
              ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate) 
              : (row.confirmationToken 
                  ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate) 
                  : '')">{{row.taxId}}
            </span></td>
        </ng-container>

        <!-- País -->
        <ng-container matColumnDef="countryCodeIso3">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"COMPANIES_TABLE.COUNTRY" | translate}} </th>
          <td [ngClass]="{
            
            'table-danger': !row.contractSigned
          }" mat-cell *matCellDef="let row"> <span [ngbTooltip]="!row.contractSigned 
              ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate) 
              : (row.confirmationToken 
                  ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate) 
                  : '')">{{row.countryCodeIso3}}
            </span></td>
        </ng-container>
        <!-- País -->
        <ng-container matColumnDef="currency">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"COMPANIES_TABLE.CURRENCY" | translate}} </th>
          <td [ngClass]="{
            
            'table-danger': !row.contractSigned
          }" mat-cell *matCellDef="let row"> <span [ngbTooltip]="!row.contractSigned 
              ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate) 
              : (row.confirmationToken 
                  ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate) 
                  : '')">{{row.currency}}
            </span></td>
        </ng-container>

        <!-- Contacto -->
        <ng-container matColumnDef="contactName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"COMPANIES_TABLE.CONTACT" | translate}} </th>
          <td [ngClass]="{
            
            'table-danger': !row.contractSigned
          }" mat-cell *matCellDef="let row"> <span [ngbTooltip]="!row.contractSigned 
              ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate) 
              : (row.confirmationToken 
                  ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate) 
                  : '')">{{row.contactName}}
            </span></td>
        </ng-container>

        <!-- Email -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"COMPANIES_TABLE.EMAIL" | translate}} </th>
          <td [ngClass]="{
            
            'table-danger': !row.contractSigned
          }" mat-cell *matCellDef="let row"> <span [ngbTooltip]="!row.contractSigned 
              ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate) 
              : (row.confirmationToken 
                  ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate) 
                  : '')">{{row.email}}
            </span></td>
        </ng-container>

        <!-- Industria -->
        <ng-container matColumnDef="industry">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"COMPANIES_TABLE.INDUSTRY" | translate}} </th>
          <td [ngClass]="{
            
            'table-danger': !row.contractSigned
          }" mat-cell *matCellDef="let row"> <span [ngbTooltip]="!row.contractSigned 
              ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate) 
              : (row.confirmationToken 
                  ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate) 
                  : '')">{{row.industry}}
            </span></td>
        </ng-container>

        <!-- Industria -->
        <!-- <ng-container matColumnDef="websiteUrl">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{"COMPANIES_TABLE.WEBSITEURL" | translate}} </th>
          <td [ngClass]="{
            
            'table-danger': !row.contractSigned
          }" mat-cell *matCellDef="let row"> <span [ngbTooltip]="!row.contractSigned 
              ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate) 
              : (row.confirmationToken 
                  ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate) 
                  : '')">{{row.websiteUrl}}
            </span></td>
        </ng-container> -->
        <ng-container matColumnDef="websiteUrl">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{"COMPANIES_TABLE.WEBSITEURL" | translate}}
          </th>
          <td [ngClass]="{
      'table-danger': !row.contractSigned
    }" mat-cell *matCellDef="let row">
            <span [ngbTooltip]="!row.contractSigned
        ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate)
        : (row.confirmationToken
            ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate)
            : '')">
              <a *ngIf="row.websiteUrl"
                [href]="row.websiteUrl.startsWith('http') ? row.websiteUrl : 'https://' + row.websiteUrl"
                target="_blank" rel="noopener noreferrer">
                {{ row.websiteUrl }}
              </a>
            </span>
          </td>
        </ng-container>


        <ng-container matColumnDef="disabled">
          <th mat-header-cell *matHeaderCellDef>{{"COMPANIES_TABLE.ACTIVE" | translate}}</th>
          <td [ngClass]="{
            
            'table-danger': !row.contractSigned
          }" mat-cell *matCellDef="let row">
            <span [class.disabled]="row.confirmationToken || !row.contractSigned " *ngIf="!row.enabled"
              (click)="row.confirmationToken || !row.contractSigned ? $event.stopPropagation() : disable(row)"
              class="material-icons text-dark mt-1 mx-2 text-center tooltip-enabled" aria-hidden="true"
              aria-label="user_attributes" [ngbTooltip]="!row.contractSigned 
  ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate)
  : (row.confirmationToken 
      ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate)  
      : ('COMPANIES_TABLE.ENABLED' | translate))">block</span>
            <span [class.disabled]="row.confirmationToken || !row.contractSigned" *ngIf="row.enabled"
              (click)="row.confirmationToken || !row.contractSigned ? $event.stopPropagation() : disable(row)"
              class="material-icons text-dark mt-1 mx-2 text-center tooltip-enabled" aria-hidden="true"
              aria-label="user_attributes" [ngbTooltip]="!row.contractSigned 
  ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate)
  : (row.confirmationToken 
      ?  ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate)  
      : ('COMPANIES_TABLE.DISABLED' | translate))">done</span>
          </td>
        </ng-container>


        <ng-container matColumnDef="edit">
          <th mat-header-cell *matHeaderCellDef>{{"COMPANIES_TABLE.EDIT" | translate}}</th>
          <td [ngClass]="{
            
            'table-danger': !row.contractSigned
          }" mat-cell *matCellDef="let row">
            <span (click)="edit(row)" class="material-icons text-dark mt-1 mx-2 text-center tooltip-enabled"
              aria-hidden="true" aria-label="user_attributes" [ngbTooltip]="!row.contractSigned 
  ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate)
  : (row.confirmationToken 
      ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate) 
      : ('COMPANIES_TABLE.EDIT' | translate))">edit</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="delete">
          <th mat-header-cell *matHeaderCellDef>{{"COMPANIES_TABLE.DELETE" | translate}}</th>
          <td [ngClass]="{
            
            'table-danger': !row.contractSigned
          }" mat-cell *matCellDef="let row">
            <span (click)="borrar(row)" class="material-icons text-dark mt-1 mx-2 text-center" aria-hidden="true"
              aria-label="user_attributes" [ngbTooltip]="!row.contractSigned 
  ? ('COMPANIES_TABLE.ACCOUNT_LOCKED' | translate)
  : (row.confirmationToken 
      ? ('COMPANIES_TABLE.CONFIRM_PENNDING' | translate) 
      : ('COMPANIES_TABLE.DELETE' | translate))">delete</span>
          </td>
        </ng-container>


        <!-- Headers y filas -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        <!-- Sin datos -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="12">
            {{ 'COMPANIES_TABLE.NO_DATA_MATCHING' | translate }}<br />
            <button routerLink="./AddCompany" [queryParams]="{ mode: 'add' }" mat-icon-button
              ngbTooltip="{{ 'COMPANIES_TABLE.ADD_COMPANY' | translate }}">
              <mat-icon>add_circle</mat-icon>
            </button>
          </td>
        </tr>
      </table>

    </div>
  </mat-expansion-panel>
</mat-accordion>